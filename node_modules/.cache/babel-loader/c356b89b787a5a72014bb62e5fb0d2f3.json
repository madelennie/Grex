{"ast":null,"code":"import _objectSpread from \"/Users/tod/Webb/grextest/Grex/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/tod/Webb/grextest/Grex/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/tod/Webb/grextest/Grex/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/tod/Webb/grextest/Grex/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/tod/Webb/grextest/Grex/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/tod/Webb/grextest/Grex/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/tod/Webb/grextest/Grex/src/components/Home/index.js\";\nimport React, { Component } from 'react';\nimport { compose } from 'recompose';\nimport { AuthUserContext, withAuthorization, withEmailVerification } from '../Session';\nimport { withFirebase } from '../Firebase';\nimport LocatedTwo from '../Geolocated';\nimport StatusPage from '../StatusPage';\nimport SignOutButton from '../SignOut';\nimport * as ROLES from '../../constants/roles';\n\nvar HomePage =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(HomePage, _Component);\n\n  function HomePage(props) {\n    var _this;\n\n    _classCallCheck(this, HomePage);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(HomePage).call(this, props));\n    _this.state = {\n      users: null,\n      latitude: null,\n      longitude: null\n    };\n    return _this;\n  }\n\n  _createClass(HomePage, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      //alert('home')\n      this.props.firebase.users().on('value', function (snapshot) {\n        _this2.setState({\n          users: snapshot.val()\n        });\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.props.firebase.users().off();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(AuthUserContext.Consumer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 39\n        },\n        __self: this\n      }, function (authUser) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 41\n          },\n          __self: this\n        }, authUser.roles.includes(ROLES.ADMIN) && React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 43\n          },\n          __self: this\n        }, React.createElement(LocatedTwo, {\n          userId: authUser.uid,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 44\n          },\n          __self: this\n        }), React.createElement(SignOutButton, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 45\n          },\n          __self: this\n        })), !authUser.roles.includes(ROLES.ADMIN) && React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 49\n          },\n          __self: this\n        }, React.createElement(StatusPage, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 50\n          },\n          __self: this\n        })));\n      });\n    }\n  }]);\n\n  return HomePage;\n}(Component);\n\nvar MessagesBase =\n/*#__PURE__*/\nfunction (_Component2) {\n  _inherits(MessagesBase, _Component2);\n\n  function MessagesBase(props) {\n    var _this3;\n\n    _classCallCheck(this, MessagesBase);\n\n    _this3 = _possibleConstructorReturn(this, _getPrototypeOf(MessagesBase).call(this, props));\n\n    _this3.onChangeText = function (event) {\n      _this3.setState({\n        text: event.target.value\n      });\n    };\n\n    _this3.onCreateMessage = function (event, authUser) {\n      _this3.props.firebase.messages().push({\n        text: _this3.state.text,\n        userId: authUser.uid,\n        createdAt: _this3.props.firebase.serverValue.TIMESTAMP\n      });\n\n      _this3.setState({\n        text: ''\n      });\n\n      event.preventDefault();\n    };\n\n    _this3.onRemoveMessage = function (uid) {\n      _this3.props.firebase.message(uid).remove();\n    };\n\n    _this3.onEditMessage = function (message, text) {\n      _this3.props.firebase.message(message.uid).set(_objectSpread({}, message, {\n        text: text,\n        editedAt: _this3.props.firebase.serverValue.TIMESTAMP\n      }));\n    };\n\n    _this3.onNextPage = function () {\n      _this3.setState(function (state) {\n        return {\n          limit: state.limit + 5\n        };\n      }, _this3.onListenForMessages);\n    };\n\n    _this3.state = {\n      text: '',\n      loading: false,\n      messages: [],\n      limit: 5\n    };\n    return _this3;\n  }\n\n  _createClass(MessagesBase, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.onListenForMessages();\n    }\n  }, {\n    key: \"onListenForMessages\",\n    value: function onListenForMessages() {\n      var _this4 = this;\n\n      this.setState({\n        loading: true\n      });\n      this.props.firebase.messages().orderByChild('createdAt').limitToLast(this.state.limit).on('value', function (snapshot) {\n        var messageObject = snapshot.val();\n\n        if (messageObject) {\n          //convert messages list from snapshot\n          var messageList = Object.keys(messageObject).map(function (key) {\n            return _objectSpread({}, messageObject[key], {\n              uid: key\n            });\n          });\n\n          _this4.setState({\n            messages: messageList,\n            loading: false\n          });\n        } else {\n          _this4.setState({\n            messages: null,\n            loading: false\n          });\n        }\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.props.firebase.messages().off();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this5 = this;\n\n      var users = this.props.users;\n      var _this$state = this.state,\n          text = _this$state.text,\n          messages = _this$state.messages,\n          loading = _this$state.loading;\n      return React.createElement(AuthUserContext.Consumer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142\n        },\n        __self: this\n      }, function (authUser) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 144\n          },\n          __self: this\n        }, !loading && messages && React.createElement(\"button\", {\n          type: \"button\",\n          onClick: _this5.onNextPage,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 147\n          },\n          __self: this\n        }, \"More\"), loading && React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 152\n          },\n          __self: this\n        }, \"Loading ...\"), messages ? React.createElement(MessageList, {\n          messages: messages.map(function (message) {\n            return _objectSpread({}, message, {\n              user: users ? users[message.userId] : {\n                userId: message.userId\n              }\n            });\n          }),\n          onRemoveMessage: _this5.onRemoveMessage,\n          onEditMessage: _this5.onEditMessage,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 155\n          },\n          __self: this\n        }) : React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 166\n          },\n          __self: this\n        }, \"There are no messages ...\") && console.log('finns ej'), React.createElement(\"form\", {\n          onSubmit: function onSubmit(event) {\n            return _this5.onCreateMessage(event, authUser);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 169\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          type: \"text\",\n          value: text,\n          onChange: _this5.onChangeText,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 170\n          },\n          __self: this\n        }), React.createElement(\"button\", {\n          type: \"submit\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 175\n          },\n          __self: this\n        }, \"Send\")));\n      });\n    }\n  }]);\n\n  return MessagesBase;\n}(Component);\n\nvar MessageList = function MessageList(_ref) {\n  var messages = _ref.messages,\n      onRemoveMessage = _ref.onRemoveMessage,\n      onEditMessage = _ref.onEditMessage;\n  return React.createElement(\"ul\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186\n    },\n    __self: this\n  }, messages.map(function (message) {\n    return React.createElement(MessageItem, {\n      key: message.uid,\n      message: message,\n      onRemoveMessage: onRemoveMessage,\n      onEditMessage: onEditMessage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189\n      },\n      __self: this\n    });\n  }));\n};\n\nvar MessageItem =\n/*#__PURE__*/\nfunction (_Component3) {\n  _inherits(MessageItem, _Component3);\n\n  function MessageItem(props) {\n    var _this6;\n\n    _classCallCheck(this, MessageItem);\n\n    _this6 = _possibleConstructorReturn(this, _getPrototypeOf(MessageItem).call(this, props));\n\n    _this6.onToggleEditMode = function () {\n      _this6.setState(function (state) {\n        return {\n          editMode: !state.editMode,\n          editText: _this6.props.message.text\n        };\n      });\n    };\n\n    _this6.onChangeEditText = function (event) {\n      _this6.setState({\n        editText: event.target.value\n      });\n    };\n\n    _this6.onSaveEditText = function () {\n      _this6.props.onEditMessage(_this6.props.message, _this6.state.editText);\n\n      _this6.setState({\n        editMode: false\n      });\n    };\n\n    _this6.state = {\n      editMode: false,\n      editText: _this6.props.message.text\n    };\n    return _this6;\n  }\n\n  _createClass(MessageItem, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          message = _this$props.message,\n          onRemoveMessage = _this$props.onRemoveMessage;\n      var _this$state2 = this.state,\n          editMode = _this$state2.editMode,\n          editText = _this$state2.editText;\n      return React.createElement(\"li\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      }, editMode ? React.createElement(\"input\", {\n        type: \"text\",\n        value: editText,\n        onChange: this.onChangeEditText,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231\n        },\n        __self: this\n      }) : React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237\n        },\n        __self: this\n      }, React.createElement(\"strong\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238\n        },\n        __self: this\n      }, message.user.username || message.user.userId), message.text, \" \", message.editedAt && React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      }, \"(Edited)\")), editMode ? React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        onClick: this.onSaveEditText,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246\n        },\n        __self: this\n      }, \"Save\"), React.createElement(\"button\", {\n        onClick: this.onToggleEditMode,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247\n        },\n        __self: this\n      }, \"Reset\")) : React.createElement(\"button\", {\n        onClick: this.onToggleEditMode,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 252\n        },\n        __self: this\n      }, \"Edit\"), !editMode && React.createElement(\"button\", {\n        type: \"button\",\n        onClick: function onClick() {\n          return onRemoveMessage(message.uid);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256\n        },\n        __self: this\n      }, \"Delete\"));\n    }\n  }]);\n\n  return MessageItem;\n}(Component);\n\nvar Messages = withFirebase(MessagesBase);\n\nvar condition = function condition(authUser) {\n  return !!authUser;\n};\n\nexport default compose(withFirebase, withEmailVerification, withAuthorization(condition))(HomePage);","map":{"version":3,"sources":["/Users/tod/Webb/grextest/Grex/src/components/Home/index.js"],"names":["React","Component","compose","AuthUserContext","withAuthorization","withEmailVerification","withFirebase","LocatedTwo","StatusPage","SignOutButton","ROLES","HomePage","props","state","users","latitude","longitude","firebase","on","snapshot","setState","val","off","authUser","roles","includes","ADMIN","uid","MessagesBase","onChangeText","event","text","target","value","onCreateMessage","messages","push","userId","createdAt","serverValue","TIMESTAMP","preventDefault","onRemoveMessage","message","remove","onEditMessage","set","editedAt","onNextPage","limit","onListenForMessages","loading","orderByChild","limitToLast","messageObject","messageList","Object","keys","map","key","user","console","log","MessageList","MessageItem","onToggleEditMode","editMode","editText","onChangeEditText","onSaveEditText","username","Messages","condition"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\n\nimport { compose } from 'recompose';\nimport { AuthUserContext, withAuthorization, withEmailVerification } from '../Session';\nimport { withFirebase } from '../Firebase';\n\nimport LocatedTwo from '../Geolocated';\nimport StatusPage from '../StatusPage';\nimport SignOutButton from '../SignOut';\nimport * as ROLES from '../../constants/roles';\n\n\n\n\nclass HomePage extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n    users: null,\n    latitude: null,\n    longitude: null,\n    };\n   \n  }\n  componentDidMount(){\n    //alert('home')\n    this.props.firebase.users().on('value', snapshot => {\n      this.setState({\n        users: snapshot.val(),\n      })\n    })    \n  }\n  componentWillUnmount(){\n    this.props.firebase.users().off();\n  }\n  \n  render() {\n    return (\n      <AuthUserContext.Consumer>\n    {authUser => (\n     <div>\n      {authUser.roles.includes(ROLES.ADMIN) && (\n        <div>\n        <LocatedTwo userId={authUser.uid} />\n        <SignOutButton />  \n        </div>\n        )}\n        {!authUser.roles.includes(ROLES.ADMIN) && (\n        <div>\n        <StatusPage /> \n        </div>\n        )}\n      \n      {/* <Messages users={this.state.users} /> */}\n      </div>\n     \n    )}\n  </AuthUserContext.Consumer>\n    \n    );\n    }\n  }\n\nclass MessagesBase extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      text: '',\n      loading: false,\n      messages: [],\n      limit: 5,\n    };\n  }\n  componentDidMount() {\n    this.onListenForMessages();\n  }\n  onListenForMessages(){\n    this.setState({ loading: true });\n\n    this.props.firebase.messages().orderByChild('createdAt').limitToLast(this.state.limit).on('value', snapshot => {\n      \n      const messageObject = snapshot.val();\n\n      if (messageObject) {\n          //convert messages list from snapshot\n          const messageList = Object.keys(messageObject).map(key => ({\n            ...messageObject[key],\n            uid: key,\n          }));\n\n          this.setState({ messages: messageList, loading: false});\n      } else {\n        this.setState({ messages: null, loading: false })\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    this.props.firebase.messages().off();\n  }\n\n  onChangeText = event => {\n    this.setState({ text: event.target.value });\n  }\n\n  onCreateMessage = (event, authUser) => {\n    this.props.firebase.messages().push({\n      text: this.state.text,\n      userId: authUser.uid,\n      createdAt: this.props.firebase.serverValue.TIMESTAMP,\n    });\n\n    this.setState({ text: '' });\n\n    event.preventDefault();\n  }\n\n  onRemoveMessage = uid => {\n    this.props.firebase.message(uid).remove();\n  }\n  onEditMessage = (message, text) => {\n    this.props.firebase.message(message.uid).set({\n      ...message,\n      text,\n      editedAt: this.props.firebase.serverValue.TIMESTAMP,\n    })\n  }\n\n  onNextPage = () => {\n    this.setState(\n      state => ({ limit: state.limit + 5 }),\n      this.onListenForMessages,\n    );\n  }\n\n  render() {\n    const { users } = this.props;\n    const { text, messages, loading } = this.state;\n\n    return (\n      <AuthUserContext.Consumer>\n        {authUser => (\n      <div>\n        {\n          !loading && messages && (\n            <button type=\"button\" onClick={this.onNextPage}>\n              More\n            </button>\n          )\n        }\n        {loading && <div>Loading ...</div>}\n\n        {messages ? (\n          <MessageList \n            messages={messages.map(message => ({\n              ...message,\n              user: users \n                ? users[message.userId]                \n                : { userId: message.userId },\n            }))} \n            onRemoveMessage={this.onRemoveMessage}\n            onEditMessage={this.onEditMessage}\n          /> \n        ) : (\n          <div>There are no messages ...</div>&& console.log('finns ej')\n        )}  \n\n        <form onSubmit={event => this.onCreateMessage(event, authUser)}>\n          <input\n            type=\"text\"\n            value={text}\n            onChange={this.onChangeText}\n          />  \n          <button type=\"submit\">Send</button>\n        </form>      \n      </div>\n      )}\n      </AuthUserContext.Consumer>\n    );\n  }\n}\n\nconst MessageList = ({ messages, onRemoveMessage, onEditMessage }) => (\n  \n  <ul>\n  \n    {messages.map(message => (\n      <MessageItem \n        key={message.uid} \n        message={message} \n        onRemoveMessage={onRemoveMessage}\n        onEditMessage={onEditMessage}\n      />\n    ))}\n  </ul>\n);\n\nclass MessageItem extends Component {\n  constructor(props){\n    super(props);\n\n    this.state = {\n      editMode: false,\n      editText: this.props.message.text,\n    };\n  }\n\n  onToggleEditMode = () => {\n    this.setState(state => ({\n      editMode: !state.editMode,\n      editText: this.props.message.text,\n    }));\n  }\n  onChangeEditText = event => {\n    this.setState({ editText: event.target.value });\n  }\n  onSaveEditText = () => {\n    this.props.onEditMessage(this.props.message, this.state.editText);\n\n    this.setState({ editMode: false });\n  }\n\n  render () {\n    const { message, onRemoveMessage } = this.props;\n    const { editMode, editText } = this.state;\n\n    return (\n      <li>\n        {editMode ? (\n          <input\n            type=\"text\"\n            value={editText}\n            onChange={this.onChangeEditText}\n          />\n        ) : (\n          <span>\n            <strong>\n              {message.user.username || message.user.userId}\n            </strong> \n            {message.text} {message.editedAt && <span>(Edited)</span>}\n          </span>\n        )}\n        {editMode ? (\n          <span>\n            <button onClick={this.onSaveEditText}>Save</button>\n            <button onClick={this.onToggleEditMode}>Reset</button>\n          </span>\n        )\n        :\n        (\n          <button onClick={this.onToggleEditMode}>Edit</button>\n        )\n        }\n        {!editMode && (\n          <button \n            type=\"button\"\n            onClick={() => onRemoveMessage(message.uid)}\n          >\n          Delete\n          </button>\n        )}\n      </li>\n    )\n  }\n}\n\nconst Messages = withFirebase(MessagesBase);\n\nconst condition = authUser => !!authUser;\n\nexport default compose(\n  withFirebase,\n  withEmailVerification,\n  withAuthorization(condition),\n  )(HomePage);\n"]},"metadata":{},"sourceType":"module"}